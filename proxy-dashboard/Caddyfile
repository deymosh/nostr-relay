{
	email your@mail.com # Mail used to generate the HTTPS certificate.
}

(nostr_redirect) {
    root * /app/build
    encode gzip

	@relayproxy {
        path /relay-proxy/*
    }

    @websockets {
        header Connection *Upgrade*
        header Upgrade    websocket
    }

    @nostr {
        header Accept application/nostr+json
    }

    reverse_proxy @websockets {$RELAY_HOST}:{$RELAY_PORT}
    reverse_proxy @nostr {$RELAY_HOST}:{$RELAY_PORT}
	reverse_proxy @relayproxy {$RELAY_PROXY_HOST}:{$RELAY_PROXY_PORT}

    file_server

    log {
        output stdout
    }
}

# used by caddy clearnet
:3000 {
	import nostr_redirect
}

# port 8080 is used by the tor hidden service to access the relay.
:8080 {
	import nostr_redirect
}
